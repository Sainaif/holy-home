<mxfile host="app.diagrams.net">
  <diagram name="Sekwencja alokacji rachunku" id="seq-bill">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1100">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Tytuł -->
        <mxCell id="title" value="Diagram sekwencji - Rozliczanie rachunku za prąd" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="700" height="30" as="geometry" />
        </mxCell>

        <!-- Actors -->
        <mxCell id="admin" value="ADMIN" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="40" height="80" as="geometry" />
        </mxCell>

        <mxCell id="user" value="USER" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="200" y="80" width="40" height="80" as="geometry" />
        </mxCell>

        <!-- Components -->
        <mxCell id="frontend" value="Frontend&lt;br&gt;(BillDetail.vue)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="320" y="80" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="billHandler" value="bill_handler" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="520" y="80" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="billService" value="bill_service" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="700" y="80" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="allocationService" value="allocation_service&lt;br&gt;(KLUCZOWY)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="880" y="80" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="database" value="MongoDB" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1080" y="80" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Lifelines -->
        <mxCell id="line1" value="" style="line;strokeWidth=2;direction=south;html=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="389" y="140" width="10" height="910" as="geometry" />
        </mxCell>
        <mxCell id="line2" value="" style="line;strokeWidth=2;direction=south;html=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="579" y="140" width="10" height="910" as="geometry" />
        </mxCell>
        <mxCell id="line3" value="" style="line;strokeWidth=2;direction=south;html=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="759" y="140" width="10" height="910" as="geometry" />
        </mxCell>
        <mxCell id="line4" value="" style="line;strokeWidth=2;direction=south;html=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="949" y="140" width="10" height="910" as="geometry" />
        </mxCell>
        <mxCell id="line5" value="" style="line;strokeWidth=2;direction=south;html=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1139" y="140" width="10" height="910" as="geometry" />
        </mxCell>

        <!-- Scenario -->
        <!-- Faza 1: Utworzenie rachunku -->
        <mxCell id="phase1" value="FAZA 1: Utworzenie rachunku (draft)" style="text;html=1;strokeColor=none;fillColor=#f5f5f5;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="180" width="280" height="30" as="geometry" />
        </mxCell>

        <mxCell id="s1" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="220" as="sourcePoint" />
            <mxPoint x="390" y="220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s1Label" value="1. Otwiera Bills, klika 'Nowy'" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s1">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="s2" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="390" y="250" as="sourcePoint" />
            <mxPoint x="580" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s2Label" value="POST /bills/" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s2">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="s3" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="580" y="280" as="sourcePoint" />
            <mxPoint x="760" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s3Label" value="CreateBill()" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s3">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="s4" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="310" as="sourcePoint" />
            <mxPoint x="1140" y="310" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s4Label" value="Insert bill (status=draft)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s4">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="30" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="note1" value="Rachunek:&lt;br&gt;type: electricity&lt;br&gt;period: 01.10 - 31.10&lt;br&gt;total_amount: 300 PLN&lt;br&gt;total_units: 500 kWh&lt;br&gt;status: draft" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1220" y="260" width="150" height="90" as="geometry" />
        </mxCell>

        <!-- Faza 2: Dodawanie odczytów -->
        <mxCell id="phase2" value="FAZA 2: Użytkownicy dodają odczyty liczników" style="text;html=1;strokeColor=none;fillColor=#f5f5f5;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="370" width="320" height="30" as="geometry" />
        </mxCell>

        <mxCell id="s5" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="220" y="410" as="sourcePoint" />
            <mxPoint x="390" y="410" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s5Label" value="2. Dodaje odczyt licznika" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s5">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="s6" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="390" y="440" as="sourcePoint" />
            <mxPoint x="1140" y="440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s6Label" value="POST /consumptions/ (user_id, bill_id, units)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s6">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="80" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="note2" value="User A: 100 kWh&lt;br&gt;User B: 150 kWh&lt;br&gt;User C: 50 kWh&lt;br&gt;Suma: 300 kWh" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1220" y="400" width="150" height="70" as="geometry" />
        </mxCell>

        <!-- Faza 3: Opublikowanie (trigger alokacji) -->
        <mxCell id="phase3" value="FAZA 3: Opublikowanie rachunku (trigger automatycznej alokacji)" style="text;html=1;strokeColor=none;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="500" width="450" height="30" as="geometry" />
        </mxCell>

        <mxCell id="s7" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="540" as="sourcePoint" />
            <mxPoint x="390" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s7Label" value="3. Klika 'Opublikuj'" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s7">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="s8" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="390" y="570" as="sourcePoint" />
            <mxPoint x="580" y="570" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s8Label" value="POST /bills/:id/post" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s8">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="s9" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="580" y="600" as="sourcePoint" />
            <mxPoint x="760" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s9Label" value="PostBill(billID)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s9">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="s10" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#d79b00;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="630" as="sourcePoint" />
            <mxPoint x="950" y="630" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s10Label" value="AllocateBillCosts(billID)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontStyle=1" vertex="1" connectable="0" parent="s10">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="15" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Algorytm alokacji -->
        <mxCell id="algoBox" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="850" y="660" width="300" height="280" as="geometry" />
        </mxCell>
        <mxCell id="algoTitle" value="ALGORYTM ALOKACJI" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="900" y="670" width="200" height="20" as="geometry" />
        </mxCell>

        <mxCell id="algo1" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="950" y="700" as="sourcePoint" />
            <mxPoint x="1140" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="algo1Label" value="Get bill" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="algo1">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="-8" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="algo2" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="950" y="730" as="sourcePoint" />
            <mxPoint x="1140" y="730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="algo2Label" value="Get active users" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="algo2">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="-8" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="algo3" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="950" y="760" as="sourcePoint" />
            <mxPoint x="1140" y="760" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="algo3Label" value="Get consumptions" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="algo3">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="-8" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="algoCalc" value="Obliczenia:&lt;br&gt;1. Suma indywidualnych = 300 kWh&lt;br&gt;2. Wspólne = 500 - 300 = 200 kWh&lt;br&gt;3. Wspólne/osoba = 200/3 = 66.67 kWh&lt;br&gt;4. Dla każdego użytkownika:&lt;br&gt;   - User A: 100 + 66.67 = 166.67 kWh&lt;br&gt;   - User B: 150 + 66.67 = 216.67 kWh&lt;br&gt;   - User C: 50 + 66.67 = 116.67 kWh&lt;br&gt;5. Przelicz na PLN (0.6 PLN/kWh):&lt;br&gt;   - User A: 100.00 PLN&lt;br&gt;   - User B: 130.00 PLN&lt;br&gt;   - User C: 70.00 PLN" style="text;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="860" y="790" width="280" height="140" as="geometry" />
        </mxCell>

        <mxCell id="algo4" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="950" y="950" as="sourcePoint" />
            <mxPoint x="1140" y="950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="algo4Label" value="Insert allocations (3 docs)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="algo4">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="20" y="-8" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="s11" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#d79b00;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="950" y="980" as="sourcePoint" />
            <mxPoint x="760" y="980" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s11Label" value="OK (allocations created)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s11">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="-20" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="s12" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="1010" as="sourcePoint" />
            <mxPoint x="1140" y="1010" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s12Label" value="Update bill (status=posted)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s12">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="30" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="s13" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="390" y="1040" as="sourcePoint" />
            <mxPoint x="100" y="1040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s13Label" value="Wyświetla podział kosztów" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="s13">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="-20" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Result -->
        <mxCell id="result" value="WYNIK:&lt;br&gt;Rachunek opublikowany (status=posted).&lt;br&gt;Każdy użytkownik widzi swoją część do zapłaty.&lt;br&gt;System automatycznie rozdzielił koszty sprawiedliwie." style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="980" width="300" height="70" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
